# 火山引擎双向流式TTS集成完成

## ✅ 集成状态

**已成功集成并测试通过！**

## 正确的配置

### API认证
- **API Key**: `d79ba916-8a76-4d5e-b9e5-dce9955c973c` (新版UUID格式)
- **Access Token**: 留空（新版API不需要）

### TTS配置
- **Resource ID**: `seed-tts-2.0` (豆包语音合成模型2.0)
- **主播A语音ID**: `zh_female_vv_uranus_bigtts` (Vivi 2.0 女声)
- **主播B语音ID**: `zh_male_m191_uranus_bigtts` (云舟 2.0 男声)

## 其他可用的2.0音色

### 通用场景
- `zh_female_vv_uranus_bigtts` - Vivi 2.0（女声，支持中英日等多语言）✅
- `zh_female_xiaohe_uranus_bigtts` - 小何 2.0（女声）
- `zh_male_m191_uranus_bigtts` - 云舟 2.0（男声）✅
- `zh_male_taocheng_uranus_bigtts` - 小天 2.0（男声）

### 视频配音场景
- `zh_female_meilinvyou_saturn_bigtts` - 魅力女友
- `zh_male_dayi_saturn_bigtts` - 大壹
- `zh_female_santongyongns_saturn_bigtts` - 流畅女声
- `zh_male_ruyayichen_saturn_bigtts` - 儒雅逸辰

### 角色扮演场景
- `saturn_zh_female_keainvsheng_tob` - 可爱女生
- `saturn_zh_female_tiaopigongzhu_tob` - 调皮公主
- `saturn_zh_male_shuanglangshaonian_tob` - 爽朗少年
- `saturn_zh_male_tiancaitongzhuo_tob` - 天才同桌

完整音色列表见：`音色列表.md`

## 技术实现要点

### 1. 二进制帧格式
正确实现了火山引擎的WebSocket二进制协议：
- Header (4字节): 协议版本 + 消息类型 + 序列化方式 + 保留位
- Event number (4字节, big-endian)
- Session ID length (4字节, big-endian) - 仅Session类和Task类消息
- Session ID - 仅Session类和Task类消息
- Payload size (4字节, big-endian)
- Payload (JSON或二进制)

### 2. 消息类型
- **Full-client request** (0x14): 客户端请求
- **Full-server response** (0x94): 服务器JSON响应
- **Audio-only response** (0xb4): 服务器音频响应
- **Error information** (0xf0): 错误消息

### 3. Event Codes
- Connection类: 1, 2, 50, 52
- Session类: 100, 102, 150, 152
- Task类: 200, 350, 351, 352

### 4. 音频数据处理
- TTSResponse (352) 使用 Audio-only response 格式
- 音频数据为原始二进制MP3格式（非Base64）
- 自动合并多个音频包

## 使用方法

### 在应用中使用
1. 打开设置页面
2. 选择TTS引擎：豆包语音合成2.0
3. 填写上述配置
4. 点击"测试TTS"验证
5. 在播客生成时会自动使用该TTS引擎

### 生成播客流程
```
原文 → LLM生成脚本 → 火山引擎TTS合成音频 → 完整播客
```

## 关键问题解决记录

1. ❌ 旧版凭证格式（App ID + Access Token）→ ✅ 新版API Key
2. ❌ 错误的音色ID (`zh_female_tianmeixiaoyuan`) → ✅ 2.0专用音色
3. ❌ 缺少Session ID字段 → ✅ 所有Session/Task类消息都需要Session ID
4. ❌ 错误的音频数据格式 → ✅ Audio-only response二进制格式

## 性能特点

- ✅ 支持流式传输，低延迟
- ✅ 高质量语音合成
- ✅ 支持多种音色和场景
- ✅ 支持中英文混合
- ✅ 自动处理文本切句

## 注意事项

1. **音色与Resource ID匹配**：必须使用对应版本的音色
2. **API Key格式**：新版使用UUID格式，旧版使用数字ID
3. **连接复用**：同一连接可进行多次session，但不支持并发
4. **Session ID长度**：建议12字节以内

## 文档参考

- 官方文档：https://www.volcengine.com/docs/6561/1257544
- 音色列表：`音色列表.md`
- 配置指南：`配置指南.md`

---

**集成完成时间**: 2026-02-18
**状态**: ✅ 生产就绪
